<!DOCTYPE html>
<html lang="en" data-bs-theme="light">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    
    
        
    
    <title>Favorites || ArabicEG.com</title>

    
    <meta name="description" content="Learn daily-use Arabic phrases with English, Bangla, and Hindi translations. Fast, offline-first and PWA-ready." />
    <meta name="robots" content="index, follow" />
    
    
    <link rel="canonical" href="http://localhost:1313/favorite/" />

    
    <meta property="og:title" content="Favorites || ArabicEG.com" />
    <meta property="og:description" content="Learn daily-use Arabic phrases with English, Bangla, and Hindi translations. Fast, offline-first and PWA-ready." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://localhost:1313/favorite/" />
    <meta property="og:image" content="http://localhost:1313/" />
    
    
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#1abc9c" />
    <link rel="apple-touch-icon" href="/favicon.svg" />
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/notyf/3.10.0/notyf.min.css" />

    
    
    <link rel="stylesheet" href="/css/main.min.css">

    
    <script>
        (function () {
            const THEME_KEY = 'preferred-theme';
            const storedTheme = localStorage.getItem(THEME_KEY);
            const theme = storedTheme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.setAttribute('data-bs-theme', theme);
        })();
    </script>
</head>

<body>
    <header class="modern-header">
    <div class="header-content">
        
        <button class="menu-btn d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar">
            <i class="bi bi-list fs-5"></i>
        </button>
        
        <a href="/" class="logo text-decoration-none">
            ArabicEG<small>.com</small>
        </a>

        <div class="d-flex gap-2">
            
            <button class="theme-btn" id="themeToggle">
                <i class="bi bi-moon fs-5"></i>
            </button>
        </div>
    </div>
</header>


<div class="offcanvas offcanvas-start modern-sidebar" tabindex="-1" id="offcanvasSidebar" aria-labelledby="offcanvasSidebarLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title footer-brand" id="offcanvasSidebarLabel">ArabicEG.com</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <nav class="modern-sidebar-nav">
    <ul class="sidebar-nav">
        <li class="sidebar-nav-item">
            <a href="/" class="sidebar-nav-link ">
                <i class="bi bi-house-door"></i> Home
            </a>
        </li>
        
        <li class="sidebar-nav-item">
            <a href="/favorite/" class="sidebar-nav-link active">
                <i class="bi-link"></i> Favorites
            </a>
        </li>
        
        <li class="sidebar-nav-item">
            <a href="/settings/" class="sidebar-nav-link ">
                <i class="bi-link"></i> Settings
            </a>
        </li>
        
        <li class="sidebar-nav-item">
            <a href="/tos/" class="sidebar-nav-link ">
                <i class="bi-link"></i> Terms of Use
            </a>
        </li>
        
        <li class="sidebar-nav-item">
            <a href="/privacy/" class="sidebar-nav-link ">
                <i class="bi-link"></i> Privacy Policy
            </a>
        </li>
        
        <li class="sidebar-nav-item">
            <a href="/contact/" class="sidebar-nav-link ">
                <i class="bi-link"></i> Contact
            </a>
        </li>
        
        <li class="sidebar-nav-item">
            <a href="/about/" class="sidebar-nav-link ">
                <i class="bi-link"></i> About
            </a>
        </li>
        
    </ul>
</nav>
  </div>
</div>

    <main id="main-content">
        
<div class="container-fluid" style="max-width: 1200px; padding: 0 1.5rem;">
  <div class="glass-card my-4 rounded px-4 pb-4">
    <div class="theme-head fw-bold fs-4 border-bottom py-2 mb-2 d-flex justify-content-between align-items-center">
      <div>

¬† <i class="bi bi-star-fill me-2"></i>

Favorites
      </div>
      <select id="languageSelect" class="form-select form-select-sm w-auto" title="Select Language">
        <option value="english">English üá¨üáß</option>
        <option value="bangla">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ üáßüá©</option>
        <option value="hindi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä üáÆüá≥</option>
        <option value="urdu">ÿßÿ±ÿØŸà üáµüá∞</option>
      </select>
    </div>

    <div class="card-body">
      
 <div id="favorites-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 px-1 sm:px-0">
            <p class="col-span-full text-center py-10 text-gray-500" id="favorites-loading">
                Loading favorites from local storage...
            </p>
        </div>



    </div>
  </div>
</div>

    </main>

    <footer class="modern-footer">
    <div class="footer-content">
        <div class="row">
            <div class="col-lg-4 mb-4 mb-lg-0">
                
                <p class="footer-description">
                    Your essential phrasebook for learning daily-use Arabic, optimized for fast, offline access.
                </p>
            </div>
            <div class="col-lg-8">
                <div class="footer-links">
                    <div class="footer-section">
                        <h6>Resources</h6>
                        <a href="/privacy-policy/">Privacy Policy</a>
                        <a href="/terms-of-service/">Terms of Service</a>
                        <a href="/sitemap.xml">Sitemap</a>
                        <a href="/contact/">Contact Us</a>
                    </div>
                    <div class="footer-section">
                        <h6>Connect</h6>
                        <a href="#" target="_blank"><i class="bi bi-facebook me-2"></i>Facebook</a>
                        <a href="#" target="_blank"><i class="bi bi-twitter-x me-2"></i>X (Twitter)</a>
                        <a href="#" target="_blank"><i class="bi bi-instagram me-2"></i>Instagram</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            &copy; 2025 ArabicEG.com. All rights reserved.
        </div>
    </div>
</footer>

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/notyf/3.10.0/notyf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0/dist/fuse.min.js"></script>
  
    <script>
  
const notyf = new Notyf({
    duration: 3000,
    position: { x: 'center', y: 'bottom' },
    types: [{
        type: 'success',
        background: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
        icon: { className: 'bi bi-check-circle', tagName: 'i' }
    }]
});


let currentLanguage = localStorage.getItem('preferred-language') || 'english';
let currentTheme = localStorage.getItem('preferred-theme') || 'light';
let favoriteIds = new Set(JSON.parse(localStorage.getItem('favorites') || '[]'));


let allPhrasesData = [];
let isDataLoaded = false;


function renderFavorites(lang = currentLanguage) {
    const container = document.getElementById("favorites-list");
    if (!container) return;
    
    container.innerHTML = "";

    if (favoriteIds.size === 0) {
        container.innerHTML = `<div class="alert alert-info mt-3">No favorites added yet ‚≠ê</div>`;
        return;
    }

    if (!isDataLoaded || !allPhrasesData || allPhrasesData.length === 0) {
        container.innerHTML = `<div class="alert alert-warning mt-3">Loading favorites...</div>`;
        return;
    }

    
    const favorites = allPhrasesData.filter(item => favoriteIds.has(item.id));

    if (favorites.length === 0) {
        container.innerHTML = `<div class="alert alert-warning mt-3">Favorite items not found in current data</div>`;
        return;
    }

    favorites.forEach(item => {
        let translation = item[lang] || item.english || "";
        let pronunciation = item[`${lang}_p`] || "";
        
        container.innerHTML += `
            <div class="list-group-item d-flex justify-content-between align-items-center">
                <div class="flex-grow-1">
                    <div class="fw-bold fs-5 text-primary mb-1">${item.arabic}</div>
                    ${pronunciation ? `<div class="text-muted small mb-1">${pronunciation}</div>` : ''}
                    <div class="text-dark">${translation}</div>
                    ${item.tags && item.tags.length > 0 ? 
                        `<div class="mt-2">
                            ${item.tags.map(tag => `<span class="badge bg-secondary me-1">${tag}</span>`).join('')}
                        </div>` : ''}
                </div>
                <div class="ms-3">
                    <button class="btn btn-sm btn-outline-danger remove-fav" data-id="${item.id}" title="Remove from favorites">
                        <i class="bi bi-heart-fill"></i>
                    </button>
                </div>
            </div>
        `;
    });

    
    document.querySelectorAll(".remove-fav").forEach(btn => {
        btn.addEventListener("click", function () {
            const id = parseInt(this.dataset.id);
            favoriteIds.delete(id);
            localStorage.setItem("favorites", JSON.stringify(Array.from(favoriteIds)));
            renderFavorites(lang);
            notyf.success('Removed from favorites');
        });
    });
}

function toggleFavorite(id) {
    if (favoriteIds.has(id)) {
        favoriteIds.delete(id);
        notyf.success('Removed from favorites');
    } else {
        favoriteIds.add(id);
        notyf.success('Added to favorites');
    }
    localStorage.setItem('favorites', JSON.stringify(Array.from(favoriteIds)));
    
    
    const favoritesContainer = document.getElementById("favorites-list");
    if (favoritesContainer) {
        renderFavorites(currentLanguage);
    }
}

const themeToggle = document.getElementById('themeToggle');
const themeIcon = themeToggle ? themeToggle.querySelector('i') : null;

function updateThemeIcon(theme) {
    if (!themeIcon) return;
    if (theme === 'dark') {
        themeIcon.className = 'bi bi-sun fs-5';
    } else {
        themeIcon.className = 'bi bi-moon fs-5';
    }
}


document.documentElement.setAttribute('data-bs-theme', currentTheme);
updateThemeIcon(currentTheme);

if (themeToggle) {
    themeToggle.addEventListener('click', () => {
        const current = document.documentElement.getAttribute('data-bs-theme');
        const newTheme = current === 'dark' ? 'light' : 'dark';
        
        document.documentElement.setAttribute('data-bs-theme', newTheme);
        localStorage.setItem('preferred-theme', newTheme);
        currentTheme = newTheme;
        updateThemeIcon(newTheme);
        
        notyf.success(`Switched to ${newTheme} mode`);
    });
}


const langRadios = document.querySelectorAll('input[name="lang"]');
const langLabels = document.querySelectorAll('.lang-btn');
const searchBox = document.getElementById('searchBox');
const resultsContainer = document.getElementById('results');
const spinner = document.getElementById('spinner');

function updateCurrentLanguage() {
    const checkedRadio = document.querySelector('input[name="lang"]:checked');
    if (checkedRadio) {
        currentLanguage = checkedRadio.value;
        localStorage.setItem('preferred-language', currentLanguage);
    }
    
    
    if (document.getElementById("favorites-list")) {
        renderFavorites(currentLanguage);
    }
    
    const query = searchBox ? searchBox.value.trim() : '';
    if (query.length > 1 || (resultsContainer && resultsContainer.children.length > 0)) {
        performSearch(query);
    }
}

function initLanguageSelection() {
    const savedLangRadio = document.querySelector(`input[value="${currentLanguage}"]`);
    if (savedLangRadio) {
        savedLangRadio.checked = true;
        const savedLabel = document.querySelector(`label[for="${savedLangRadio.id}"]`);
        if (savedLabel) {
            savedLabel.classList.add('active');
        }
    }
}

if (langRadios.length > 0) {
    langRadios.forEach(radio => {
        radio.addEventListener('change', () => {
            langLabels.forEach(label => label.classList.remove('active'));
            const newLabel = document.querySelector(`label[for="${radio.id}"]`);
            if (newLabel) {
                newLabel.classList.add('active');
            }
            updateCurrentLanguage();
            notyf.success(`Language switched to ${radio.value}`);
        });
    });
}

const DB_NAME = 'searchDatabase';
const DB_VERSION = 1;
const OBJECT_STORE_NAME = 'searchPhrases';
let db;

function initDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        request.onerror = event => reject(event.target.error);
        request.onupgradeneeded = event => {
            const db = event.target.result;
            if (!db.objectStoreNames.contains(OBJECT_STORE_NAME)) {
                const objectStore = db.createObjectStore(OBJECT_STORE_NAME, { keyPath: 'id' });
                objectStore.createIndex('arabic', 'arabic', { unique: false });
                objectStore.createIndex('english', 'english', { unique: false });
                objectStore.createIndex('tags', 'tags', { unique: false, multiEntry: true });
            }
        };
        request.onsuccess = event => {
            db = event.target.result;
            resolve(db);
        };
    });
}

async function fetchDataAndStoreInDB() {
    try {
        const response = await fetch('/data/main.json');
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();
        
        const transaction = db.transaction([OBJECT_STORE_NAME], 'readwrite');
        const objectStore = transaction.objectStore(OBJECT_STORE_NAME);
        
        await new Promise((resolve, reject) => {
            const clearRequest = objectStore.clear();
            clearRequest.onsuccess = () => resolve();
            clearRequest.onerror = event => reject(event.target.error);
        });
        
        data.forEach(item => objectStore.add(item));
        
        transaction.oncomplete = () => {
            allPhrasesData = data;
            isDataLoaded = true;
            displayAvailableTags();
            initCategoryCards();
            
            if (document.getElementById("favorites-list")) {
                renderFavorites(currentLanguage);
            }
            notyf.success('Search data updated successfully!');
            console.log('All data added to IndexedDB and memory');
        };

        transaction.onerror = event => {
            console.error('Transaction error:', event.target.error);
            notyf.error('Failed to save search data.');
        };
    } catch (error) {
        console.error('Error fetching or storing data:', error);
        notyf.error('Failed to load search data from the server.');
    }
}

async function loadDataAndInit() {
    try {
        await initDB();
        const transaction = db.transaction([OBJECT_STORE_NAME], 'readonly');
        const objectStore = transaction.objectStore(OBJECT_STORE_NAME);
        const countRequest = objectStore.count();

        countRequest.onsuccess = async event => {
            if (event.target.result === 0) {
                await fetchDataAndStoreInDB();
            } else {
                console.log('IndexedDB already contains data.');
                const getAllRequest = objectStore.getAll();
                getAllRequest.onsuccess = event => {
                    allPhrasesData = event.target.result;
                    isDataLoaded = true;
                    displayAvailableTags();
                    displayRecentSearches();
                    initCategoryCards();
                    
                    if (document.getElementById("favorites-list")) {
                        renderFavorites(currentLanguage);
                    }
                };
                getAllRequest.onerror = event => {
                    console.error('Failed to get all data:', event.target.error);
                    notyf.error('Failed to load data from IndexedDB.');
                };
            }
        };
    } catch (error) {
        console.error('Failed to initialize or check DB:', error);
    }
}


function initCategoryCards() {
    console.log('Initializing category cards...');
    
    const categoryCards = document.querySelectorAll('.category-card');
    categoryCards.forEach(card => {
        card.addEventListener('click', () => {
            const tagValue = card.dataset.tag;
            console.log(`Category card clicked: ${tagValue}`);
            
            if (!isDataLoaded || !allPhrasesData || allPhrasesData.length === 0) {
                console.error('No data available');
                notyf.error('Data not loaded yet. Please wait...');
                return;
            }
            
            if (searchBox) searchBox.value = '';
            
            filteredResults = allPhrasesData.filter(item => {
                return item.tags && Array.isArray(item.tags) && item.tags.includes(tagValue);
            });
            
            console.log(`Found ${filteredResults.length} results for tag: ${tagValue}`);
            
            currentPage = 1;
            displaySearchResults(filteredResults.slice(0, RESULTS_PER_PAGE));
            notyf.success(`Browsing "${tagValue}" category`);
            smoothScrollToResults();
        });
    });
    
    console.log(`Initialized ${categoryCards.length} category cards`);
}


const favoritesToggleBtn = document.getElementById('favoritesToggle');
const showAllBtn = document.getElementById('showAll');

if (favoritesToggleBtn) {
    favoritesToggleBtn.addEventListener('click', () => {
        if (!isDataLoaded) {
            notyf.error('Data not loaded yet. Please wait...');
            return;
        }
        const favorites = allPhrasesData.filter(item => favoriteIds.has(item.id));
        displaySearchResults(favorites);
        favoritesToggleBtn.style.display = 'none';
        if (showAllBtn) showAllBtn.style.display = 'inline-block';
    });
}

if (showAllBtn) {
    showAllBtn.addEventListener('click', () => {
        if (!isDataLoaded) {
            notyf.error('Data not loaded yet. Please wait...');
            return;
        }
        displaySearchResults(allPhrasesData);
        showAllBtn.style.display = 'none';
        if (favoritesToggleBtn) favoritesToggleBtn.style.display = 'inline-block';
    });
}


let searchTimeout;
const RESULTS_PER_PAGE = 10;
let currentPage = 1;
let filteredResults = [];
const loadMoreBtn = document.getElementById('loadMoreBtn');

if (searchBox) {
    searchBox.addEventListener('input', (e) => {
        const query = e.target.value.trim();
        clearTimeout(searchTimeout);
        
        if (query.length < 2) {
            filteredResults = allPhrasesData;
            currentPage = 1;
            displaySearchResults(filteredResults.slice(0, RESULTS_PER_PAGE));
            return;
        }

        if (spinner) spinner.style.display = 'block';
        searchTimeout = setTimeout(() => {
            performSearch(query);
        }, 700);
    });
}

function filterData(query) {
    if (!query) return allPhrasesData;
    const lowerCaseQuery = query.toLowerCase();
    const queryWords = lowerCaseQuery.split(/\s+/).filter(word => word.length > 0);

    return allPhrasesData.filter(item => {
        const searchableText = `${item.arabic} ${item.english} ${item.english_p} ${item.tags ? item.tags.join(' ') : ''}`.toLowerCase();
        return queryWords.every(word => searchableText.includes(word));
    });
}

function fuzzyFilterData(query) {
    if (!query) return [];

    const fuzzyPattern = query.split(/\s+/).filter(word => word.length > 0)
        .map(word => [...word].join('.*'))
        .join('.*');

    const fuzzyRegex = new RegExp(fuzzyPattern, 'i');

    return allPhrasesData.filter(item => {
        const searchableText = `${item.arabic} ${item.english} ${item.english_p} ${item.tags ? item.tags.join(' ') : ''}`.toLowerCase();
        return fuzzyRegex.test(searchableText);
    });
}

function performSearch(query) {
    if (!isDataLoaded) {
        notyf.error('Data not loaded yet. Please wait...');
        if (spinner) spinner.style.display = 'none';
        return;
    }
    
    let results = [];
    const exactMatches = filterData(query);
    
    if (exactMatches.length === 0) {
        results = fuzzyFilterData(query);
    } else {
        results = exactMatches;
    }

    filteredResults = results;
    currentPage = 1;
    
    setTimeout(() => {
        if (spinner) spinner.style.display = 'none';
        displaySearchResults(filteredResults.slice(0, RESULTS_PER_PAGE));
        addToRecentSearches(query);
        setTimeout(smoothScrollToResults, 150); 
    }, 300); 
}

function displaySearchResults(results) {
    if (!resultsContainer) return;
    
    if (currentPage === 1) {
        resultsContainer.innerHTML = '';
    }

    if (results.length === 0 && currentPage === 1) {
        resultsContainer.innerHTML = `<div class="col-12"><p class="text-center text-muted mt-5">No results found.</p></div>`;
        if (loadMoreBtn) loadMoreBtn.style.display = 'none';
        return;
    }

    results.forEach(result => {
        const cardHtml = createResultCard(result, currentLanguage);
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = cardHtml.trim();
        const cardElement = tempDiv.firstChild;
        
        resultsContainer.appendChild(cardElement);
        
        const favoriteBtn = cardElement.querySelector('.favorite-btn');
        const copyBtn = cardElement.querySelector('.copy-btn');

        if (favoriteBtn) {
            favoriteBtn.addEventListener('click', () => {
                toggleFavorite(result.id);
                const icon = favoriteBtn.querySelector('i');
                icon.className = favoriteIds.has(result.id) ? 'bi bi-heart-fill text-danger' : 'bi bi-heart';
            });
        }

        if (copyBtn) {
            copyBtn.addEventListener('click', async () => {
                const text = copyBtn.dataset.text;
                try {
                    await navigator.clipboard.writeText(text);
                    notyf.success('Copied to clipboard');
                } catch (err) {
                    notyf.error('Failed to copy');
                }
            });
        }
    });

    const totalDisplayed = currentPage * RESULTS_PER_PAGE;
    if (totalDisplayed < filteredResults.length) {
        if (loadMoreBtn) loadMoreBtn.style.display = 'block';
    } else {
        if (loadMoreBtn) loadMoreBtn.style.display = 'none';
    }
}

function createResultCard(result, lang) {
    const translationKey = lang;
    const pronunciationKey = `${lang}_p`;
    const heartClass = favoriteIds.has(result.id) ? 'bi-heart-fill text-danger' : 'bi-heart';

    let badgeText = '';
    let badgeClass = '';
    switch (lang) {
        case 'english': badgeText = 'EN'; badgeClass = 'bg-primary'; break;
        case 'bangla': badgeText = '‡¶¨‡¶æ‡¶Ç'; badgeClass = 'bg-success'; break;
        case 'hindi': badgeText = '‡§π‡§ø‡§Ç'; badgeClass = 'bg-warning'; break;
        case 'urdu': badgeText = 'ÿßÿ±ÿØŸà'; badgeClass = 'bg-info'; break;
        default: badgeText = 'EN'; badgeClass = 'bg-primary';
    }

    const tagsHtml = (result.tags || [])
        .map(tag => `<span class="badge bg-secondary me-1 tag-clickable" data-tag="${tag}">${tag}</span>`)
        .join('');

    return `
        <div class="col-12 col-md-6 col-lg-4">
            <div class="glass-card p-4 h-100">
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <div class="arabic-text fs-2 fw-bold text-primary">${result.arabic}</div>
                    <div class="d-flex gap-2">
                        <button class="btn btn-sm btn-outline-primary favorite-btn" data-id="${result.id}">
                            <i class="bi ${heartClass}"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-secondary copy-btn" data-text="${result.arabic}">
                            <i class="bi bi-clipboard"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mb-3">
                    <div class="text-muted small mb-1">Pronunciation</div>
                    <div class="fw-medium">${result[pronunciationKey] || ''}</div>
                </div>

                <div class="translations mb-3">
                    <div class="mb-2">
                        <span class="badge ${badgeClass} me-2">${badgeText}</span>
                        <span>${result[translationKey] || ''}</span>
                    </div>
                </div>

                ${tagsHtml ? `<div class="tags-section">
                    <div class="text-muted small mb-2">Tags</div>
                    <div>${tagsHtml}</div>
                </div>` : ''}
            </div>
        </div>
    `;
}

function loadMoreResults() {
    currentPage++;
    const start = (currentPage - 1) * RESULTS_PER_PAGE;
    const end = start + RESULTS_PER_PAGE;
    const nextResults = filteredResults.slice(start, end);
    
    displaySearchResults(nextResults);
}

if (loadMoreBtn) {
    loadMoreBtn.addEventListener('click', loadMoreResults);
}


const tagsContainer = document.getElementById('tags-container');
const recentList = document.getElementById('recent-list');
const recentContainer = document.getElementById('recent-ul');
const dynamicTagsSection = document.getElementById('dynamic-tags-section');

function displayAvailableTags() {
    if (!tagsContainer || allPhrasesData.length === 0) return;
    if (dynamicTagsSection) dynamicTagsSection.style.display = 'block';

    const allTags = new Set();
    allPhrasesData.forEach(phrase => {
        if (phrase.tags && Array.isArray(phrase.tags)) {
            phrase.tags.forEach(tag => allTags.add(tag));
        }
    });

    const sortedTags = Array.from(allTags).sort();
    tagsContainer.innerHTML = sortedTags.map(tag => 
        `<button class="tag-pill" data-tag="${tag}">${tag}</button>`
    ).join('');

    document.querySelectorAll('#tags-container .tag-pill').forEach(tagBtn => {
        tagBtn.addEventListener('click', () => {
            const tagValue = tagBtn.dataset.tag;
            if (searchBox) searchBox.value = '';
            filteredResults = allPhrasesData.filter(item => item.tags && item.tags.includes(tagValue));
            currentPage = 1;
            displaySearchResults(filteredResults.slice(0, RESULTS_PER_PAGE));
            notyf.success(`Browsing "${tagValue}" phrases`);
            smoothScrollToResults();
        });
    });
}

function addToRecentSearches(query) {
    let recent = JSON.parse(localStorage.getItem('recentSearches') || '[]');
    recent = recent.filter(item => item !== query);
    recent.unshift(query);
    recent = recent.slice(0, 5);
    localStorage.setItem('recentSearches', JSON.stringify(recent));
    displayRecentSearches();
}

function displayRecentSearches() {
    if (!recentList || !recentContainer) return;
    
    const recent = JSON.parse(localStorage.getItem('recentSearches') || '[]');
    
    if (recent.length > 0) {
        recentList.style.display = 'block';
        recentContainer.innerHTML = recent.map(query => 
            `<button class="tag-pill recent-search" data-query="${query}">${query}</button>`
        ).join('');
        
        document.querySelectorAll('.recent-search').forEach(btn => {
            btn.addEventListener('click', () => {
                const query = btn.dataset.query;
                if (searchBox) searchBox.value = query;
                performSearch(query);
                smoothScrollToResults();
            });
        });
    } else {
        recentList.style.display = 'none';
    }
}

function smoothScrollToResults() {
    const resultsSection = document.getElementById('results-section') || document.getElementById('results');
    if (resultsSection) {
        resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}


const installBanner = document.getElementById('installBanner');
const installBtn = document.getElementById('installBtn');
const dismissBanner = document.getElementById('dismissBanner');

if (installBanner && installBtn && dismissBanner) {
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBanner.classList.add('show');
    });

    installBtn.addEventListener('click', async () => {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
                notyf.success('App installed successfully!');
            }
            deferredPrompt = null;
            installBanner.classList.remove('show');
        }
    });

    dismissBanner.addEventListener('click', () => {
        installBanner.classList.remove('show');
    });
}


document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
            target.scrollIntoView({ behavior: 'smooth' });
        }
    });
});


if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
            .then(registration => console.log('SW registered:', registration))
            .catch(error => console.error('SW registration failed:', error));
    });
}



document.addEventListener('DOMContentLoaded', () => {
    initLanguageSelection();
    displayRecentSearches();
    loadDataAndInit();
});
</script>

<script>
  const langSelect = document.getElementById('languageSelect');

  function updateVisibleLanguage(lang) {
    document.querySelectorAll('.lang-section').forEach(section => {
      section.classList.toggle('d-none', section.dataset.lang !== lang);
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('preferred-language') || 'english';
    langSelect.value = savedLang;
    updateVisibleLanguage(savedLang);
  });

  langSelect.addEventListener('change', () => {
    const selectedLang = langSelect.value;
    localStorage.setItem('preferred-language', selectedLang);
    updateVisibleLanguage(selectedLang);

    if (typeof notyfQueue !== 'undefined' && typeof notyfQueue.show === 'function') {
      notyf.success(`‚úÖ  Preference saved: ${selectedLang.toUpperCase()}`);
    } else {
      console.log(`Language preference saved: ${selectedLang.toUpperCase()}`);
    }
  });
</script>
</body>

</html>